/*
HTML5 Data Bindings
Version: 1.6.2
(c) 2014 DMXzone.com
@build 2014-04-25 11:14:37
*/
!function(a,b,c,d){function e(b){return"object"==typeof b?!a.isEmptyObject(b):!!b}function f(b){if(null==b||"object"!=typeof b)return b;var c=a.isArray(b)?[]:{};for(var d in b)b.hasOwnProperty(d)&&(c[d]=f(b[d]));return c}function g(a,b){function c(a){var b=0;for(var c in a)a.hasOwnProperty(c)&&b++;return b}if(typeof a!=typeof b)return!1;if("function"==typeof a)return a.toString()===b.toString();if(a instanceof Object&&b instanceof Object){if(c(a)!=c(b))return!1;for(var d in a)if(!g(a[d],b[d]))return!1;return!0}return a===b}function h(a,b,c,d){return b=b||G,a.replace(A,function(a,e){if("@"==e[0])return"{{"+e.slice(1)+"}}";var f=w(e,b);return c&&b.watch(e,c,d),null==f?"":f})}function i(a){return a.replace(/^\{\{@?|\}\}$/g,"")}function j(a){return encodeURIComponent(a)}function k(a){return decodeURIComponent(a.replace(/\+/g," "))}function n(a){for(var b={},c=/([^&=]+)=?([^&]*)/g;m=c.exec(a);)b[k(m[1])]=k(m[2]);return b}function o(b,d){var e=history&&history.pushState,f=c.location,g=n(e?f.search.substr(1):f.hash.substr(2));null==d?delete g[b]:g[b]=d,e?history.pushState(null,null,"?"+a.param(g)):f.hash="?"+a.param(g),a.dmxDataBindings.globalScope.update("$URL")}function p(a){o(a)}function q(a,b){G.add(a,b)}function r(a){G.get(a)}function s(a){G.remove(a)}function t(a,b){b instanceof Element&&(b=x.closest(b)),G.add(a,b.data)}function u(){function a(b,c){if("object"!=typeof b){b=b.split(" ");for(var e=0,f=b.length;f>e;e++)d[b[e]]||(d[b[e]]=[]),d[b[e]].push(c)}else for(var g in b)a(g,b[g])}function b(a){var b=Array.prototype.slice.call(arguments,1);a=a.split(" ");for(var c=0,e=a.length;e>c;c++)for(var f in d)if(a[c]==f||"*"==f.substr(f.length-1)&&0===a[c].indexOf(f.substr(0,f.length-1)))for(var g=0,h=d[f].length;h>g;g++)d[f][g].apply(null,b)}function c(a,b){a=a.split(" ");for(var c=0,e=a.length;e>c;c++)if(d[a[c]])if(b){for(var f=d[a[c]].length-1;f>=0;f--)if(d[a[c]][f]==b)return d[a[c]].splice(f,1),void 0}else delete d[a[c]]}var d={};return{add:a,exec:b,remove:c}}function v(a){function b(b){return b>1?a.substr(v,b):a[v]}function c(b){return b=b||1,v+b<a.length?a[v+b]:!1}function d(a){return-1!=a.indexOf(r)}function e(a){return'"'==a||"'"==a}function f(a){return a>="0"&&"9">=a}function g(a){return a>="a"&&"z">=a||a>="A"&&"Z">=a||"_"==a||"$"==a}function h(a){return g(a)||f(a)}function i(a){return" "==a||"\r"==a||"	"==a||"\n"==a||""==a||"Â "==a}function j(a){return"-"==a||"+"==a||f(a)}function k(c){var d="",e=!1;for(v++;v<a.length;){if(r=b(),e){if("u"==r){v++;var f=b(4);if(f.match(/[\da-f]{4}/i))throw Error("Invalid unicode escape");d+=String.fromCharCode(parseInt(f,16)),v+=3}else{var g=y[r];d+=g?g:r}e=!1}else if("\\"==r)e=!0;else{if(r==c)return v++,d;d+=r}v++}throw Error("Unterminated quote")}function l(){for(var e="",g=!1;v<a.length;){if(r=b(),d(".")&&c()&&f(c())||f(r))e+=r;else{var h=c();if(d("eE")&&j(h))e+="e",g=!0;else{if(!(j(r)&&h&&f(h)&&g)){if(!j(r)||h&&f(h)||!g)break;throw Error("Invalid exponent")}e+=r,g=!1}}v++}return+e}function m(){for(var c="";v<a.length&&(r=b(),h(r));)c+=r,v++;return c}function n(){var c="",d="",e=!1;for(v++;v<a.length;){if(r=b(),e)e=!1;else if("\\"==r)e=!0;else if("/"==r){for(v++;-1!="ign".indexOf(r=b());)d+=r,v++;return c+"%%%"+d}c+=r,v++}throw Error("Unterminated regexp")}for(var o,p,q,r,s,t,u=[],v=0,w=!0,x={"(":"L_PAREN",")":"R_PAREN","[":"L_BRACKET","]":"R_BRACKET",".":"PERIOD",",":"COMMA",":":"COLON","?":"QUESTION","+":"ADDICTIVE","-":"ADDICTIVE","*":"MULTIPLICATIVE","/":"MULTIPLICATIVE","%":"MULTIPLICATIVE","===":"EQUALITY","!==":"EQUALITY","==":"EQUALITY","!=":"EQUALITY","<":"RELATIONAL",">":"RELATIONAL","<=":"RELATIONAL",">=":"RELATIONAL","in":"RELATIONAL","&&":"LOGICAL_AND","||":"LOGICAL_OR","!":"LOGICAL_NOT","&":"BITWISE_AND","|":"BITWISE_OR","^":"BITWISE_XOR","~":"BITWISE_NOT","<<":"BITWISE_SHIFT",">>":"BITWISE_SHIFT",">>>":"BITWISE_SHIFT"},y={n:"\n",f:"\f",r:"\r",t:"	",v:"","'":"'",'"':'"'};v<a.length;){if(q=v,r=b(),e(r)&&w)p="STRING",o=k(r),w=!1;else if((f(r)||d(".")&&c()&&f(c()))&&w)p="NUMBER",o=l(),w=!1;else if(g(r)&&w)p="IDENT",o=m(),d("(")&&(p="METHOD"),w=!1;else if(d("/")&&w)p="REGEXP",o=n(),w=!1;else{if(i(r)){v++;continue}if((t=b(3))&&x[t])p=x[t],o=t,w=!0,v+=3;else if((s=b(2))&&x[s])p=x[s],o=s,w=!0,v+=2;else{if(!x[r])throw Error("Lexer Error: Unexpected token '"+r+"' at column "+v+" in expression ["+a+"]");p=x[r],o=r,w=!0,v++}}u.push({name:p,index:q,value:o})}return u}function w(c,e){function g(){if(0===J.length)throw Error("Unexpected end of expression: "+c);return J[0]}function h(a){if(J.length>0){var b=J[0];if(!a||b.name==a)return b}return!1}function i(a){var b=h(a);return b?(J.shift(),b):!1}function j(a){if(!i(a))throw Error("Unexpected token, expecting ["+a+"]. expression: "+c)}function k(a){var b=Array.prototype.slice.call(arguments,1);return function(){return L.hasOwnProperty(a)?L[a].apply(e,b):a}}function l(){function a(){for(var a,c=0;c<b.length;c++){var d=b[c];d&&(a=d())}return a}for(var b=[];;)return J.length>0&&!h("R_PAREN")&&!h("R_BRACKET")&&b.push(m()),(1==b.length?b[0]:a)()}function m(){return n()}function n(){var a,b,c=o();if(b=i("QUESTION")){if(a=n(),b=i("COLON"))return k("?",c,a,n());throw Error("Parse Error")}return c}function o(){for(var a,b=p();;){if(!(a=i("LOGICAL_OR")))return b;b=k(a.value,b,p())}}function p(){var a,b=q();return(a=i("LOGICAL_AND"))&&(b=k(a.value,b,p())),b}function q(){var a,b=r();return(a=i("BITWISE_OR"))&&(b=k(a.value,b,r())),b}function r(){var a,b=s();return(a=i("BITWISE_XOR"))&&(b=k(a.value,b,s())),b}function s(){var a,b=t();return(a=i("BITWISE_AND"))&&(b=k(a.value,b,s())),b}function t(){var a,b=u();return(a=i("EQUALITY"))&&(b=k(a.value,b,t())),b}function u(){var a,b=x();return(a=i("RELATIONAL"))&&(b=k(a.value,b,u())),b}function x(){for(var a,b=y();a=i("BITWISE_SHIFT");)b=k(a.value,b,y());return b}function y(){for(var a,b=z();a=i("ADDICTIVE");)b=k(a.value,b,z());return b}function z(){for(var a,b=B();a=i("MULTIPLICATIVE");)b=k(a.value,b,B());return b}function B(){var a;return(a=i("ADDICTIVE"))?"+"==a.value?C():k(a.value,N,B()):(a=i("LOGICAL_NOT"))?k(a.value,B()):C()}function C(){var a,c;if(i("L_PAREN"))a=m(),j("R_PAREN");else if(i("L_BRACKET"))a=F(k(e.getData()));else if(i("PERIOD"))a=h()?H(k(e.getData())):k(e.getData());else{var f=i();if(f===!1)throw Error("Not a primary expression");a="IDENT"==f.name?M.hasOwnProperty(f.value)?M[f.value]:function(){return e.get(f.value)}:"METHOD"==f.name?k(K[f.value]||function(){return b.console&&console.warn("Formatter "+f.value+" doesn't exist"),d}):"REGEXP"==f.name?function(){var a=f.value.split("%%%");return new RegExp(a[0],a[1])}:function(){return f.value}}for(;c=i("L_PAREN")||i("L_BRACKET")||i("PERIOD");)if("("==c.value)a=D(a,I);else if("["==c.value)I=a,a=F(a);else{if("."!=c.value)throw Error("Parse Error");I=a,a=H(a)}return I=null,a}function D(b,c){var d=[];if("R_PAREN"!=g().name)do d.push(m());while(i("COMMA"));return j("R_PAREN"),function(){for(var e=[c()],f=0;f<d.length;f++)e.push(d[f]());var g=b()||a.noop;return g.apply(null,e)}}function F(a){var b=m();return j("R_BRACKET"),function(){var c=a(),e=b();return"object"!=typeof c?d:c[e]}}function H(a){var c=i();return function(){var e=a();return"METHOD"==c.name?K[c.value]||function(){return b.console&&console.warn("Formatter "+c.value+" doesn't exist"),d}:e&&e.hasOwnProperty(c.value)?e[c.value]:d}}if(e=e||G,"{{"==c.substr(0,2)&&"}}"==c.substr(-2)&&-1==c.indexOf("{{",2)&&(c=c.substring(2,c.length-2)),-1!=c.indexOf("{{"))return c.replace(A,function(a,b){if("@"==b.substr(0,1))return"{{"+b.slice(1)+"}}";var c=w(b,e);return null==c?"":c});var I,J=E[c]?E[c]:v(c),K=a.dmxDataBindings.filters,L={"in":function(a,b){return a()in b()},"?":function(a,b,c){return a()?b():c()},"+":function(a,b){return a=a(),b=b(),null==a?b:null==b?a:a+b},"-":function(a,b){return a()-b()},"*":function(a,b){return a()*b()},"/":function(a,b){return a()/b()},"%":function(a,b){return a()%b()},"===":function(a,b){return a()===b()},"!==":function(a,b){return a()!==b()},"==":function(a,b){return a()==b()},"!=":function(a,b){return a()!=b()},"<":function(a,b){return a()<b()},">":function(a,b){return a()>b()},"<=":function(a,b){return a()<=b()},">=":function(a,b){return a()>=b()},"&&":function(a,b){return a()&&b()},"||":function(a,b){return a()||b()},"&":function(a,b){return a()&b()},"|":function(a,b){return a()|b()},"^":function(a,b){return a()^b()},"<<":function(a,b){return a()<<b()},">>":function(a,b){return a()>>b()},">>>":function(a,b){return a()>>>b()},"~":function(a){return~a()},"!":function(a){return!a()}},M={PI:function(){return Math.PI},$this:function(){return e.getData()},$global:function(){return G.getData()},$parent:function(){return e.parentScope&&e.parentScope.getData()},"null":function(){return null},"true":function(){return!0},"false":function(){return!1}},N=function(){return 0};return E[c]=f(J),l()}function x(b){var c=this,e=u(),h={},j=[],k={},l={};this.parentScope=b,b&&b.hook("digest",function(a){c.digest(a)}),this.add=function(a,b){this.exists(a)&&g(l[a],b)||(l[a]=f(b),j.push(a),D.runOnce(this.digest,this))},this.create=function(b){var c=new x(this);return b&&a.data(b,"scope",c),c},this.destroy=function(){b&&b.unhook("digest",function(a){c.digest(a)})},this.digest=function(a){if(a||(a=[]),j=j.concat(a),0!==j.length){var b=new RegExp("(^|\\b)("+j.join("|").replace(/\$/g,"")+")(\\b|$)");for(var c in k)if(b.test(c)){var d=w(c,this);if(!g(k[c].value,F.test(c)?w(c.replace(F,"")):d)){for(var f=k[c].callbacks,h=0;h<f.length;h++)D.run(f[h].callback,null,d,k[c].value);k[c].value=d}}e.exec("digest",j),j=[]}},this.exists=function(a){return l&&a&&l.hasOwnProperty(a)},this.find=this.parse,this.get=function(a){return this.exists(a)?l[a]:this.parentScope?this.parentScope.get(a):d},this.getData=function(){return l},this.hook=e.add,this.parse=function(a){return w(a,this)},this.register=function(a,b,c){return h[a]=b,null!=c&&(l[a]=c),this},this.remove=function(a){delete l[a],j.push(a),D.runOnce(this.digest,this)},this.set=function(b){var c;for(c in l)j.push(c);for(c in b)j.push(c);l=a.isPlainObject(b)?f(b):{},D.runOnce(this.digest,this)},this.unhook=e.remove,this.unwatch=function(a,b){if(a=i(a).replace(F,""),k[a])for(var c=k[a].length-1;c>=0;c--)k[a][c].callback==b&&k[a].splice(c,1)},this.unwatchNS=function(a,b){if(a=i(a).replace(F,""),k[a])for(var c=k[a].length-1;c>=0;c--)k[a][c].namespace==b&&k[a].splice(c,1)},this.update=function(a){var b=h[a],c=Array.prototype.slice.call(arguments,1);return this.add(a,b.apply(l[a],c)),this},this.watch=function(a,b,c){if(a&&!/^(\{\{)?@/.test(a)){var d=w(a,this);k[a]=k[a]||{callbacks:[],value:F.test(a)?w(a.replace(F,"")):d},k[a].callbacks.push({callback:b,namespace:c}),D.runOnce(b,null,d)}}}function y(a,b){if("string"==typeof a)return h(a,b||G);if("object"==typeof a)for(var c in a)y(a[c],b);return a}function z(b){this.elm=b,this.data=[],this.defaultIndex=0,this.defaultPage=1,this.pageSize=-1,this.params={$selectedItem:null,$selectedIndex:-1,$currentPage:1,$totalPages:1,$totalItems:0},this.hooks=u(),a.data(this.elm,"repeater",this),D.run(this.init,this)}a.single=function(a){return function(b){return a[0]=b,a}}(a([1])),a.dmxDataBindings={};{var A=/\{\{(.+?)\}\}/g,B=c.documentElement;Object.prototype.toString.apply}a.dmxDataBindings.$parseTemplate=h;var C={getItem:function(a){return k(c.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+j(a).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},setItem:function(a,b,d,e,f,g){if(!a||/^(?:expires|max\-age|path|domain|secure)$/i.test(a))return!1;var h="",i=new Date;if(d)switch(d.constructor){case Number:h=1/0===d?"; expires=Tue, 19 Jan 2038 03:14:07 GMT":"; expires="+i.setTime(i.getTime()+864e5*d).toUTCString();break;case String:h="; expires="+d;break;case Date:h="; expires="+d.toUTCString()}return c.cookie=j(a)+"="+j(b)+h+(f?"; domain="+f:"")+(e?"; path="+e:"")+(g?"; secure":""),D.runOnce(G.update,G,"$COOKIE"),!0},removeItem:function(a,b,d){return a&&this.hasItem(a)?(c.cookie=j(a)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(d?"; domain="+d:"")+(b?"; path="+b:""),!0):!1},hasItem:function(a){return new RegExp("(?:^|;\\s*)"+j(a).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(c.cookie)}};a.dmxDataBindings.setVariable=q,a.dmxDataBindings.getVariable=r,a.dmxDataBindings.removeVariable=s,a.dmxDataBindings.setScopeData=t,a.dmxDataBindings.setCookie=C.setItem,a.dmxDataBindings.removeCookie=C.removeItem,a.dmxDataBindings.setUrlParam=o,a.dmxDataBindings.removeUrlParam=p;var D=function(){var a=Array.prototype.slice,b={},c={clear:function(){for(var a in b)clearTimeout(a);b={}},exists:function(a){for(var c in b)if(b[c]==a)return!0;return!1},run:function(c,d){var e=a.call(arguments,2),f=setTimeout(function(){c.apply(d,e),delete b[f]},0);return b[f]=c,f},runNow:function(b,c){var d=a.call(arguments,2);return b.apply(c,d)},runOnce:function(b,d){var e=a.call(arguments);return c.exists(b)?!1:c.run.apply(d,e)}};return c}();a.dmxDataBindings.$lexer=v;var E={};a.dmxDataBindings.$parse=w;var F=/\.\s*randomize\s*\(\s*\)/g,G=new x;x.closest=function(b){for(var c;b;b=b.parentNode)if(c=a.data(b,"scope"))return c;return G},x.create=function(a){var b=x.closest(a).create(a);return b},x.destroy=function(b){var c=a.data(b,"scope");c&&c.destroy()},G.register("$URL",function(){var a=b.location,c=a.search.substr(1);return 0===a.hash.indexOf("#?")&&(c+="&"+a.hash.substr(2)),n(c)}).update("$URL"),G.register("$COOKIE",function(){for(var a,b={},d=/((?:^|\s*)[^;=]+)=?([^;]*)/g;a=d.exec(c.cookie);)b[k(a[1])]=k(a[2]);return b}).update("$COOKIE"),G.register("$FORM",function(){var b={};return a.each(a(":input").serializeArray(),function(c,d){var e=d.name,f=d.value;e in b?(a.isArray(b[e])||(b[e]=[b[e]]),b[e].push(f)):b[e]=f}),b}),a(b).on("popstate hashchange",function(){G.update("$URL")}),a(c).on("change",function(){G.update("$FORM")}),a(c).ready(function(){G.update("$FORM")}),q("$loading",!1),q("$lasterror",d),a(c).ajaxStart(function(){q("$loading",!0)}).ajaxStop(function(){q("$loading",!1)}).ajaxError(function(b,c,d,e){var f=c.responseText;/json/.test(c.getResponseHeader("Content-Type"))&&a.parseJSON(f),q("$lasterror",{code:c.status,status:e,message:c.responseText})}),a.ajaxPrefilter(function(a){y(a,a.scope)}),a.dmxDataBindings.filters={"default":function(a,b){return null==a?b:a},then:function(a,b,c){return e(a)?b:c},toNumber:function(a){return+a},toString:function(a){return a+""},parseJSON:function(b){return a.parseJSON(b)}};var H=function(){var a=u();return{ignore:{script:1,iframe:1},hook:a.add,unhook:a.remove,parse:function(b){var c=b&&b.tagName&&b.tagName.toLowerCase(),d={preventDefault:!1,parseAttributes:!0,parseChildren:!0,stop:!1};if(a.exec("start",b,d),!d.stop&&(a.exec("tag:"+c,b,d),!d.stop)){if(d.parseAttributes)for(var e,f=b.attributes.length;f--;)if(e=b.attributes[f],e&&e.specified){if(a.exec("attr:"+e.name,b,e,d),d.stop)return;d.preventDefault||H.parseAttribute(b,e),d.preventDefault=!1}if(c&&!H.ignore[c]&&d.parseChildren&&b.hasChildNodes()){var g;for(g=b.firstChild;g;g=g.nextSibling){switch(g.nodeType){case 1:H.parse(g);break;case 3:if(a.exec("text",b,g,d),d.stop)return;H.parseNode(b,g);break;case 8:a.exec("comment",b,g,d)}if(d.stop)return}}}},parseAttribute:function(a,b){var c=b.value,d=x.closest(a);-1!=c.indexOf("{{")&&(b.value=h(c,d,function(){b.value=h(c,d)}))},parseNode:function(a,b){var c=b.nodeValue,d=x.closest(a);-1!=c.indexOf("{{")&&(b.nodeValue=h(c,d,function(){b.nodeValue=h(c,d)}))}}}();H.hook({start:function(a,b){a.hasAttribute("data-binding-repeat")&&(new z(a),b.stop=!0)},text:function(b,c,d){if("textarea"==b.tagName.toLowerCase()){var e=c.nodeValue,f=x.closest(b);a.single(b).val(h(e,f,function(){a.single(b).val(h(e,f)).triggerHandler("render"),D.runOnce(G.update,G,"$FORM")})),d.stop=!0}},"attr:value":function(b,c){var d=c.value,e=x.closest(b);a.single(b).val(h(d,e,function(){a.single(b).val(h(d,e)).triggerHandler("render"),D.runOnce(G.update,G,"$FORM")}))},"attr:data-binding-repeat-children":function(a,b,c){new z(a),c.preventDefault=!0,c.parseChildren=!1},"attr:data-binding-repeat-index attr:data-binding-repeat-page attr:data-binding-repeat-size":function(a,b,c){c.preventDefault=!0},"attr:data-binding-scope":function(b,c){var d=x.closest(b),e=x.create(b);d.watch(c.value,a.proxy(e,"set"))},"attr:data-binding-detail":function(b,c){var d=x.create(b);d.parentScope.watch(c.value+".$selectedItem",a.proxy(d,"set"))},"attr:data-binding-html":function(b,c,d){x.closest(b).watch(c.value,function(c){a.single(b).html(c)}),b.removeAttribute(c.name),d.parseChildren=!1},"attr:data-binding-text":function(b,c,d){x.closest(b).watch(c.value,function(c){a.single(b).text(c)}),b.removeAttribute(c.name),d.parseChildren=!1},"attr:data-binding-selected":function(a,b){x.closest(a).watch(b.value,function(b){a.selected=e(b)}),a.removeAttribute(b.name)},"attr:data-binding-checked":function(a,b){x.closest(a).watch(b.value,function(b){a.checked=e(b)}),a.removeAttribute(b.name)},"attr:data-binding-disabled":function(a,b){x.closest(a).watch(b.value,function(b){a.disabled=e(b)}),a.removeAttribute(b.name)},"attr:data-binding-value":function(b,c){var d=c.value,e=x.closest(b);e.watch(d,function(c){a.single(b).val(c).triggerHandler("render"),D.runOnce(G.update,G,"$FORM")}),a(b).on("repeatRender.dmxDataBindings",function(){a.single(this).val(w(d,e)).triggerHandler("render"),D.runOnce(G.update,G,"$FORM")}),b.removeAttribute(c.name)},"attr:data-binding-show":function(b,c){x.closest(b).watch(c.value,function(c){a(b).toggle(e(c))}),b.removeAttribute(c.name)},"attr:data-binding-hide":function(b,c){x.closest(b).watch(c.value,function(c){a(b).toggle(!e(c))}),b.removeAttribute(c.name)},"attr:data-binding-class-*":function(b,c){var d=c.name.substr(19);x.closest(b).watch(c.value,function(c){a(b).toggleClass(d,e(c))}),b.removeAttribute(c.name)},"attr:data-binding-style":function(b,c){function d(c){var d,e,f,g=c.split(";");for(d=0;d<g.length;d++)e=g[d],e&&(f=e.indexOf(":"),-1!=f&&a(b).css(e.substr(0,f),e.substr(f+1)))}var e=c.value,f=x.closest(b);d(h(e,f,function(){d(h(e,f))}))},"attr:data-binding-src attr:data-binding-href":function(b,c){var d=c.name.substr(13),e=c.value,f=x.closest(b);a(b).attr(d,h(e,f,function(){a(b).attr(d,h(e,f))})),b.removeAttribute(c.name)}}),a.dmxDataBindings.regions={};var I=0,J="Repeat",K="RepeatChildren",L="data-binding-repeat",M="data-binding-id",N=L+"-children",O=L+"-index",P=L+"-page",Q=L+"-size";z.prototype={init:function(){var b=this;if(this.elm.hasAttribute(L))this.type=J,this.expression=a.single(this.elm).attr(L),this.elm.removeAttribute(L);else{if(!this.elm.hasAttribute(N))throw"Invalid Repeater Region";this.type=K,this.expression=a.single(this.elm).attr(N),this.elm.removeAttribute(N)}this.id=this.elm.hasAttribute(M)?a.single(this.elm).attr(M):this.elm.id?this.elm.id:"Region"+ ++I,a.dmxDataBindings.regions[this.id]=this,a.single(this.elm).is("select,option")&&(this.$select=a.single(this.elm).closest("select")),this.scope=x.closest(this.elm),this["setup"+this.type](),this.updateScopeProps(),this.$select&&this.$select.on("change",function(){var c=a("option:selected",this);c.length?b.select(c[0]):b.setSelectedIndex(-1)}),this.elm.hasAttribute(O)&&(this.defaultIndex=a.single(this.elm).attr(O),0===this.defaultIndex.indexOf("{{")&&this.scope.watch(this.defaultIndex,function(a){b.defaultIndex=null!=a?a:0,b.select(a)},"repeater:"+this.id),this.elm.removeAttribute(O)),this.elm.hasAttribute(P)&&(this.defaultPage=a.single(this.elm).attr(P),0===this.defaultPage.indexOf("{{")&&this.scope.watch(this.defaultPage,function(a){b.defaultPage=null!=a?a:1,b.setPage(a)},"repeater:"+this.id),this.elm.removeAttribute(P)),this.elm.hasAttribute(Q)&&(this.pageSize=a.single(this.elm).attr(Q),0===this.pageSize.indexOf("{{")&&this.scope.watch(this.pageSize,function(a){b.pageSize=null!=a?parseInt(a)||-1:-1,b.render()},"repeater:"+this.id),this.pageSize=parseInt(this.pageSize)||-1,this.elm.removeAttribute(P)),this.expression=i(this.expression),this.scope.watch(this.expression,a.proxy(this,"set"),"repeater:"+this.id)},updateScopeProps:function(){var a=this.scope;do a.add(this.id,this.params);while(a=a.parentScope)},set:function(b){var c,d=this;if("number"==typeof b){var e=b;for(b=[],c=0;e>c;c++)b.push(c)}if(null==b&&(b=[]),a.isArray(b)||a.isPlainObject(b)){this.data=[],c=0;for(var f in b)if(b.hasOwnProperty(f)){var g=b[f],h=a.extend(!0,{},g);h.$key=h.$name=f,h.$value=g,h.$index=c,h.$number=c+1,h.$oddeven=c%2,h.$selected=!1,this.data.push(h),c++}this.params.$selectedItem=null,this.params.$selectedIndex=-1,this.params.$totalItems=this.data.length,this.params.$totalPages=this.pageSize>0?Math.ceil(this.data.length/this.pageSize):1,this.hooks.exec("data",this),this.updateScopeProps(),this["prepare"+this.type](),this.render(),D.runOnce(function(){d.select(d.defaultIndex),d.setPage(d.defaultPage)})}},setPage:function(a){if(-1!=this.pageSize&&this.params.$totalItems){var b=this.params.$currentPage;if(l=this.params.$totalPages,"string"==typeof a)switch(a){case"first":a=1;break;case"last":a=l;break;case"middle":a=Math.ceil(l/2);break;case"next":a=b+1;break;case"prev":a=b-1;break;case"random":a=Math.ceil(Math.random()*l);break;default:a=parseInt(a)}isNaN(a)&&(a=1),a=1>a?1:a>l?l:a,a!=this.params.$currentPage&&(this.params.$currentPage=a,this.hooks.exec("pageChanged",this),this.updateScopeProps(),this.render())}},setSelectedIndex:function(a){var b;if(this.params.$totalItems){a=parseInt(a),isNaN(a)&&(a=-1),-1!=this.params.$selectedIndex&&(b=this.getScope(this.params.$selectedIndex),b.add("$selected",!1));var c=this.data.length;-1!=a?(a=0>a?0:a>=c?c-1:a,b=this.getScope(a),b.add("$selected",!0),this.params.$selectedItem=b.getData()):this.params.$selectedItem=null,this.params.$selectedIndex=a,this.hooks.exec("select",this),this.updateScopeProps()}},select:function(a){if(this.params.$totalItems){var b=this.params.$selectedIndex,c=this.params.$totalItems;if("string"==typeof a)switch(a){case"none":a=-1;break;case"first":a=0;break;case"last":a=c-1;break;case"middle":a=Math.floor(c/2);break;case"next":a=b>=c-1?0:b+1;break;case"prev":a=0>=b?c-1:b-1;break;case"random":a=Math.floor(Math.random()*c);break;default:a=parseInt(a)}else"object"==typeof a&&(a.$index?a=a.$index:a instanceof Element&&(a=x.closest(a).get("$index")));(null==a||isNaN(a))&&(a=-1),this.setSelectedIndex(a)}},sort:function(a,b){if(this.data.length){this.data.sort(function(b,c){var d=(a?b[a]:b)||"",e=(a?c[a]:c)||"";return"string"==typeof d&&"string"==typeof e?d.localeCompare(e):e>d?-1:d>e?1:0}),b&&"DESC"==b.toUpperCase()&&this.data.reverse();for(var c=0,d=this.params.$totalItems;d>c;c++){var e=this.getScope(c);e.add("$index",c),e.add("$number",c+1),e.add("$oddeven",c%2),e.digest(),e.get("$selected")&&(this.params.$selectedIndex=c)}this.hooks.exec("sort",this),this.render()}},getChild:function(a){return this.children[this.data[a].$key]},getScope:function(a){return this.getChild(a).data("scope")},render:function(){var a=this;this.hooks.exec("beforeRender",this),this["clear"+this.type]().then(function(){if(a.data.length){var b=0,c=a.data.length;a.pageSize>0&&(b=(a.params.$currentPage-1)*a.pageSize,c=b+a.pageSize,c>a.data.length&&(c=a.data.length));for(var d=b;c>d;d++)a["render"+a.type](d);a.$select&&a.$select.trigger("repeatRender"),D.runOnce(G.update,G,"$FORM"),a.hooks.exec("afterRender",a)}})},setupRepeat:function(){this.startNode=c.createComment("START REPEAT"),this.endNode=c.createComment("END REPEAT"),this.template=a(this.elm).before(this.startNode).after(this.endNode).detach()},prepareRepeat:function(){this.children&&this.destroyRepeat(),this.children={};for(var a=0,b=this.data.length;b>a;a++){var c=this.template.clone(!0);this.scope.create(c[0]).set(this.data[a]),H.parse(c[0]),this.children[this.data[a].$key]=c}},renderRepeat:function(a){this.getChild(a).insertBefore(this.endNode)},destroyRepeat:function(){var a=this;this.clearRepeat().then(function(){for(var b in a.children){var c=a.children[b];x.destroy(c[0]),c.remove()}})},clearRepeat:function(){for(var b,c=new jQuery.Deferred,d=this.startNode.nextSibling;d&&d!==this.endNode;)b=d.nextSibling,a.single(d).detach(),d=b;return c.resolve(),c.promise()},setupRepeatChildren:function(){this.template=a.single(this.elm).children().detach()},prepareRepeatChildren:function(){function a(){e.scope.create(this).set(e.data[b]),H.parse(this)}var b,c,d,e=this;for(this.children&&this.destroyRepeatChildren(),this.children={},b=0,c=this.data.length;c>b;b++)d=this.template.clone(!0).each(a),this.children[this.data[b].$key]=d},renderRepeatChildren:function(a){this.getChild(a).appendTo(this.elm)},destroyRepeatChildren:function(){function a(){x.destroy(this)}var b=this;this.clearRepeatChildren().then(function(){for(var c in b.children){var d=b.children[c];d.each(a),d.remove()}})},clearRepeatChildren:function(){var b=new jQuery.Deferred;return a.single(this.elm).children().detach(),b.resolve(),b.promise()}},a.dmxDataBindings.Scope=x,a.dmxDataBindings.RepeaterRegion=z,a.dmxDataBindings.globalScope=G,a.dmxDataBindings.renderer=H,a.dmxDataBindings.executer=D,a(c).ready(function(){H.parse(B)})}(jQuery,this,document);